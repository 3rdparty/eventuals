load("@rules_cc//cc:defs.bzl", "cc_test")

copts_ = [
    "-Werror",
    "-Wno-error=deprecated-declarations",
]

eventuals_base_sources = [
    "eventual.cc",
    "stream.cc",
    "lock.cc",
    "repeat.cc",
    "then.cc",
    "conditional.cc",
    "callback.cc",
    "static-thread-pool.cc",
    "task.cc",
    "closure.cc",
    # "parallel.cc",
    "iterate.cc",
    "collect.cc",
    "filter.cc",
    "take.cc",
    "range.cc",
    "let.cc",
    "stream-for-each.cc",
]

eventuals_events_sources = [
    "timer.cc",
    "filesystem.cc",
    "event-loop-test.h",
    "dns-resolver.cc",
    "signal.cc",
]

eventuals_http_sources = select({
    "@bazel_tools//src/conditions:windows": [],
    "//conditions:default": [
        # NOTE: we don't compile any of the tests for eventuals-http
        # on Windows because we currently can't reliably compile
        # either OpenSSL or boringssl on Windows (see #59).
    ],
})

cc_test(
    name = "eventuals",
    srcs = eventuals_base_sources + eventuals_events_sources + eventuals_http_sources,
    copts = copts_,
    deps = [
        "//:eventuals",
        "@com_github_google_googletest//:gtest_main",
    ],
)
