load("@rules_cc//cc:defs.bzl", "cc_library", "cc_test")
load("//bazel:copts.bzl", "copts")

cc_library(
    name = "expect-throw-what",
    hdrs = [
        "expect-throw-what.h",
    ],
    visibility = ["//visibility:public"],
)

cc_library(
    name = "http-mock-server",
    testonly = True,
    srcs = ["http-mock-server.cc"],
    hdrs = ["http-mock-server.h"],
    copts = copts(),
    deps = [
        "//eventuals",
        "@com_github_chriskohlhoff_asio//:asio",
        "@com_github_google_googletest//:gtest",
    ],
)

cc_test(
    name = "eventuals",
    srcs = [
        "callback.cc",
        "catch.cc",
        "closure.cc",
        "collect.cc",
        "conditional.cc",
        "dns-resolver.cc",
        "do-all.cc",
        "event-loop-test.h",
        "eventual.cc",
        "executor.cc",
        "expected.cc",
        "filesystem.cc",
        "filter.cc",
        "finally.cc",
        "flat-map.cc",
        "foreach.cc",
        "generator.cc",
        "http.cc",
        "if.cc",
        "iterate.cc",
        "just.cc",
        "let.cc",
        "lock.cc",
        "pipe.cc",
        "poll.cc",
        "range.cc",
        "repeat.cc",
        "signal.cc",
        "static-thread-pool.cc",
        "stream.cc",
        "take.cc",
        "task.cc",
        "then.cc",
        "timer.cc",
        "transformer.cc",
        "type-check.cc",
        "type-traits.cc",
        "unpack.cc",
    ],
    copts = copts(),
    deps = [
        ":expect-throw-what",
        ":http-mock-server",
        "//eventuals",
        "//test/concurrent",
        "@com_github_google_googletest//:gtest_main",
    ],
)
